<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OBS-Die-Firma ‚Äì Sortiment</title>
  <meta name="description" content="OBS-Die-Firma: Glas-Tags & Deluxe Kakao. Jetzt bestellen und in der Sch√ºlerfirma abholen.">
  <meta name="theme-color" content="#003b1f">

  <!-- Moderne, gut lesbare Typo -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      color-scheme:light dark;
      --accent-green:#0c8a43; --green:#34c759; --deep-green:#0b5d2a; --gold:#d4af37; --price:#d40000;
      --ink:#161817; --ink-2:#2a2f2b; --muted:#5b625e; --border:#e6e9e7; --surface:#ffffff;
      --ring:#98e1b3;
    }
    *{box-sizing:border-box}
    html,body{overscroll-behavior-y:contain}

    body{
      margin:0; min-height:100vh;
      display:grid; place-items:start center;
      font-family:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size:16.5px; text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased;
      color:var(--ink); letter-spacing:.005em; line-height:1.55;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(0,180,90,.08), transparent 60%),
        radial-gradient(800px 400px at 110% -20%, rgba(0,60,30,.08), transparent 60%),
        radial-gradient(1200px 600px at 50% 120%, rgba(0,0,0,.04), transparent 60%),
        #fff;
      padding:2rem;
    }
    main{width:min(1000px,100%)}

    /* ===== TICKER ===== */
    .ticker{width:100%;overflow:hidden;margin:-.5rem 0 1.25rem 0}
    .ticker-bar{
      background:linear-gradient(90deg,#2fb457,#0c8a43);
      color:#fff; font-weight:700; padding:.8rem 0; border-radius:12px;
      box-shadow:0 10px 24px rgba(0,0,0,.07);
    }
    .ticker-track{
      display:inline-block; white-space:nowrap; will-change:transform;
      animation:ticker 120s linear infinite;
      font-size:1.02rem; letter-spacing:.01em;
    }
    .ticker-item{display:inline-flex; align-items:center; gap:.45rem; margin:0 1.6rem}
    .ticker-item small{opacity:.95; font-weight:600}
    @keyframes ticker{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}

    /* ===== Hero + Nacht-Himmel ===== */
    .hero{margin:0 0 1.6rem; text-align:center; perspective:1000px; position:relative; overflow:visible}
    /* Night sky liegt √úBER dem Logo-Bereich, verblendet nach unten */
    .night-sky{
      position:absolute; left:50%; transform:translateX(-50%);
      top:-26vh; width:120vw; height:56vh; pointer-events:none; z-index:0;
      background:
        radial-gradient(100% 80% at 50% 100%, rgba(2,12,20,0) 0%, rgba(2,12,20,.0) 40%, rgba(2,12,20,.7) 70%, rgba(2,12,20,1) 100%),
        radial-gradient(140% 100% at 50% 10%, #07131c 0%, #030b12 60%, #02070d 100%);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,.92) 60%, rgba(0,0,0,0) 100%);
    }
    .stars{position:absolute; inset:0; overflow:hidden}
    .star{
      position:absolute; width:2px; height:2px; border-radius:50%;
      background:#ffffff; opacity:.85; filter:drop-shadow(0 0 3px rgba(255,255,255,.75));
      animation:twinkle var(--twDur,4s) ease-in-out var(--twDelay,0s) infinite alternate;
    }
    @keyframes twinkle{from{opacity:.2; transform:scale(.8)} to{opacity:1; transform:scale(1.15)}}

    /* Shooting star */
    .shooting{
      position:absolute; width:140px; height:2px; background:linear-gradient(90deg,#fff, rgba(255,255,255,0));
      opacity:.0; transform:translateX(0) translateY(0) rotate(var(--rot, -20deg));
      filter:drop-shadow(0 0 6px rgba(255,255,255,.9));
      animation:shoot 1.6s ease-in-out forwards;
    }
    @keyframes shoot{
      0%   {opacity:0; transform:translateX(0) translateY(0) rotate(var(--rot))}
      10%  {opacity:.95}
      100% {opacity:0; transform:translateX(var(--dx, -520px)) translateY(var(--dy, 160px)) rotate(var(--rot))}
    }

    .brand-wrap{position:relative; display:inline-block; z-index:1}
    .brand{
      margin:0; text-transform:uppercase; letter-spacing:.06em; font-weight:900;
      font-size:clamp(3rem,12vw,6.6rem); line-height:.95;
      background:linear-gradient(180deg,#0b5d2a 0%,#0c8a43 35%,#34c759 65%,#c8ffd8 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 1px 0 rgba(0,0,0,.18),0 2px 6px rgba(0,0,0,.18),0 8px 30px rgba(0,0,0,.18);
      transform-style:preserve-3d; transform-origin:center; animation:slowFlip 18s linear infinite; position:relative;
    }
    @keyframes slowFlip{0%{transform:rotateX(0)}50%{transform:rotateX(180deg)}100%{transform:rotateX(360deg)}}
    .brand::before{
      content:""; position:absolute; inset:-6% -10%; pointer-events:none;
      background:linear-gradient(120deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.35) 12%,rgba(255,255,255,0) 24%);
      transform:translateX(-130%) skewX(-10deg); filter:blur(.5px); mix-blend-mode:screen; animation:shine 6s ease-in-out infinite
    }
    @keyframes shine{0%{transform:translateX(-130%) skewX(-10deg)}50%{transform:translateX(130%) skewX(-10deg)}100%{transform:translateX(130%) skewX(-10deg)}}

    .brand-underline{width:min(520px,74%);height:8px;margin:.7rem auto 0;border-radius:999px;background:linear-gradient(90deg,#34c759,#0c8a43,#34c759);box-shadow:0 8px 26px rgba(52,199,89,.35)}
    .tagline{margin:.9rem 0 0;font-weight:800;font-size:clamp(1.05rem,3.6vw,1.35rem);letter-spacing:.08em;text-transform:uppercase;color:#183c26;opacity:.9}

    @media (prefers-reduced-motion: reduce){
      .brand,.brand::before,.star,.shooting{animation:none}
    }

    /* ===== Headings/Text ===== */
    h2{margin:0 0 .4rem;font-size:clamp(1.25rem,4.5vw,1.6rem);letter-spacing:.01em}
    p{margin:0;color:var(--ink-2);font-size:clamp(1rem,3.2vw,1.06rem)}
    a{color:inherit;text-decoration:none}
    a:focus-visible,button:focus-visible,input:focus-visible,textarea:focus-visible,select:focus-visible{
      outline:3px solid var(--ring);outline-offset:2px;border-radius:8px
    }

    /* ===== Produktkarten ‚Äì eleganter Look + exakt gleiche H√∂hen ===== */
    .slot{
      border:1px solid var(--border); border-radius:16px; padding:1.2rem 1.25rem;
      text-align:left; background:var(--surface); box-shadow:0 8px 24px rgba(0,0,0,.05);
      display:flex; flex-direction:column; height:100%;
    }
    .slot+.slot{margin-top:1rem}
    .slots{
      margin-top:1.5rem; display:grid; gap:1rem;
      grid-template-columns:1fr; align-items:stretch; grid-auto-rows:1fr;
    }
    .slots > .slot{height:100%}
    @media (min-width:720px){.slots{grid-template-columns:repeat(2,1fr)}}

    .slot-body{display:block}
    .slot-footer{margin-top:auto;display:block}
    .price-row{display:flex;justify-content:flex-start;align-items:center;gap:.5rem;font-weight:800;margin-top:.25rem}

    .badge{display:inline-block;margin-left:.5rem;background:var(--accent-green);color:#fff;border-radius:.6rem;padding:.12rem .55rem;font-size:.86em;vertical-align:middle}
    .price-old{color:var(--price);text-decoration:line-through;text-decoration-thickness:.12em;text-decoration-color:var(--price);font-weight:700}
    .price-new{color:var(--price);font-weight:800}
    .price-kakao{color:#111!important;font-weight:800}
    .price-list{margin:.55rem 0 0;padding-left:1.1rem;color:var(--price);font-weight:700}
    .price-list li{margin:.15rem 0}
    .note{margin-top:.6rem;font-size:.95em;font-weight:600}
    .asterisk-note{margin-top:.4rem;font-size:.95em;color:var(--price);font-weight:700}

    img{display:block;max-width:100%;height:auto;margin:1rem auto 0;user-select:none;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.07)}

    /* ===== Formular / Warenkorb ===== */
    form.shop{text-align:left;margin-top:1.6rem}
    .card{
      border:1px solid var(--border);border-radius:16px;background:#fff;
      padding:18px;margin-top:16px;box-shadow:0 8px 24px rgba(0,0,0,.05)
    }
    .grid{display:grid;gap:12px}
    .row{display:grid;grid-template-columns:1fr 140px 160px;gap:8px;align-items:end}
    .row>div{display:grid;gap:6px}

    input,textarea,select,button{font:inherit}
    input,textarea,select{
      padding:11px 12px;border:1px solid var(--border);border-radius:10px;width:100%;background:#fff;color:var(--ink);
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,textarea:focus,select:focus{border-color:#b9e8cc;box-shadow:0 0 0 3px rgba(52,199,89,.15)}
    input[readonly]{background:#f8f9f8}

    button{
      padding:12px 16px;border-radius:12px;border:0;
      background:linear-gradient(180deg,#1b8a46,#0e6b37);
      color:#fff;cursor:pointer;font-weight:800;letter-spacing:.03em;
      box-shadow:0 10px 26px rgba(12,138,67,.25);
      transition:transform .08s ease, box-shadow .12s ease;
    }
    button:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(12,138,67,.3)}

    .muted{color:var(--muted);font-size:.96rem}
    .totals{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-weight:800}
    .error{color:#b00020;font-size:.95rem}
    .success{color:#0a7a30;font-size:.95rem}
    .hidden{display:none}
    hr.sep{border:0;border-top:1px solid var(--border);margin:12px 0}

    footer{margin-top:2rem;font-size:.98rem;opacity:.95}
    footer nav a{text-decoration:underline}

    /* ===== Werbeaktion Spiel ===== */
    .game-grid{display:grid;grid-template-columns:repeat(3,90px);grid-gap:10px;justify-content:center;margin-top:12px;touch-action:manipulation}
    .tile{
      width:90px;height:90px;border-radius:12px;border:1px solid var(--border);background:#f7f8f7;
      cursor:pointer;position:relative;overflow:hidden;transition:transform .08s ease-in, box-shadow .08s ease-in;
      display:grid;place-items:center; -webkit-tap-highlight-color:transparent; -webkit-user-select:none;user-select:none; outline:none;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    .tile:active{transform:scale(.98)}
    .cover{position:absolute;inset:0;background:linear-gradient(180deg,#fafafa,#eceeec);pointer-events:none}
    .revealed{border-color:#cfd6d1}
    .game-controls{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px;flex-wrap:wrap}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f6f7f6;border:1px solid var(--border);font-weight:600}
    .win{color:#0a7a30;font-weight:800}
    .lose{color:#b00020;font-weight:800}

    /* Glas-SVG */
    .glass{width:72px;height:72px;display:block}
  </style>
</head>
<body>
  <!-- ===== TICKER ===== -->
  <div class="ticker">
    <div class="ticker-bar">
      <div id="tickerTrack" class="ticker-track">Lade Neuigkeiten ‚Ä¶</div>
    </div>
  </div>

  <main>
    <header class="hero" aria-label="Markenbereich">
      <!-- Nachthimmel -->
      <div class="night-sky" aria-hidden="true">
        <div class="stars" id="starsLayer"></div>
      </div>

      <div class="brand-wrap">
        <h1 class="brand">OBS-Die-Firma</h1>
      </div>

      <div class="brand-underline" aria-hidden="true"></div>
      <div class="tagline">Sortiment</div>
    </header>

    <!-- Produkt 1 -->
    <article class="slot">
      <div class="slot-body">
        <h2>#1 Personalisierter Glas-Tag <span class="badge" aria-label="Sonderaktion">*</span></h2>
        <p class="desc"><strong>Das sinnvolle Gadget f√ºr gesellige Runden.</strong> Du planst eine Familienfeier, Geburtstag oder √§hnliches? Dann √ºberrasche deine G√§ste mit einer besonderen Aufmerksamkeit. So f√ºhlt man sich gleich am richtigen Platz. Und auch f√ºr die Kids praktisch, die h√§ufig die Gl√§ser vertauschen. Das spart zudem an Wasser und Strom f√ºr die Sp√ºlmaschine.</p>

        <p class="desc" style="margin-top:.6rem">Vorher: <span class="price-old">3 ‚Ç¨</span></p>
        <ul class="price-list" aria-label="Aktionspreise">
          <li>Einzelpreis: <span class="price-new">1,50 ‚Ç¨</span></li>
          <li>F√ºnferpack: <span class="price-new">4,95 ‚Ç¨</span></li>
          <li>Zehnerpack: <span class="price-new">9,95 ‚Ç¨</span></li>
        </ul>
        <p id="deal-note" class="asterisk-note">* Sonderaktion: g√ºltig solange der Vorrat reicht.</p>

        <ul class="price-list" style="margin-top:.6rem;color:inherit;font-weight:700">
          <li style="color:inherit">Material: PLA, PETG</li>
          <li style="color:inherit">Reinigung: nur feucht abwischen</li>
          <li style="color:inherit">Passform: fester Sitz</li>
        </ul>
      </div>
      <div class="slot-footer">
        <img src="Tag.jpeg" alt="Personalisierter Glas-Tag" width="900" height="600" loading="eager" fetchpriority="high" decoding="async">
      </div>
    </article>

    <section class="slots" aria-label="Weitere Produkte">
      <!-- Produkt 2 -->
      <article class="slot">
        <div class="slot-body">
          <h2>#2 Deluxe Kakao ‚ÄûChocolate Bomb‚Äú <span class="price">¬∑ <span class="price-kakao">5 ‚Ç¨</span></span></h2>
          <p class="desc"><strong>‚ÄûChocolate Bomb‚Äú inklusive Glas:</strong> mit hei√üer Milch aufgie√üen ‚Äì die Kugel schmilzt zu cremigem Kakao. Samtig, rund, intensives Schoko-Aroma.</p>
          <p class="desc" style="margin-top:.5rem"><strong>Inhaltsstoffe:</strong> Kuvert√ºre, Kakaopulver.</p>
        </div>
        <div class="slot-footer">
          <div class="price-row" aria-hidden="true">Preis: <strong class="price-kakao">5,00 ‚Ç¨</strong></div>
          <img src="Tag2.jpeg" alt="Deluxe Kakao Chocolate Bomb" width="900" height="600" loading="lazy" decoding="async">
        </div>
      </article>

      <!-- Produkt 3 (bald verf√ºgbar) -->
      <article class="slot">
        <div class="slot-body">
          <h2>#3 ‚Äì bald verf√ºgbar</h2>
          <p class="desc">Trag dich per E-Mail ein, dann informieren wir dich, sobald das Produkt startet.</p>
        </div>
        <div class="slot-footer">
          <div class="price-row muted">Preis: folgt</div>
        </div>
      </article>
    </section>

    <!-- ========= Werbeaktion: Spiel ========= -->
    <section class="card" aria-labelledby="promoTitle">
      <h2 id="promoTitle">Werbeaktion: Gewinne einen Glas-Tag</h2>
      <p class="desc">Decke in 5 Versuchen drei gleichfarbige Gl√§ser auf.</p>
      <div class="game-controls">
        <button type="button" id="startGameBtn">Spiel starten</button>
        <button type="button" id="newGameBtn" class="hidden">Neues Spiel</button>
        <span class="pill">Versuche √ºbrig: <span id="triesLeft">‚Äì</span></span>
        <span class="pill">Treffer gleichfarbig: <span id="matchCount">0</span></span>
        <span class="pill hidden" id="cooldownPill">N√§chstes Spiel in <span id="cooldownSec">0</span>s</span>
      </div>
      <div id="gameGrid" class="game-grid" aria-label="3x3 Spielfeld"></div>
      <div id="gameMsg" class="desc" style="margin-top:8px;"></div>
    </section>

    <!-- ========= Shop-Formular / Warenkorb ========= -->
    <form id="orderForm" class="shop" novalidate>
      <input type="text" id="hp_field" name="company" autocomplete="off" style="position:absolute;left:-9999px" tabindex="-1" aria-hidden="true">

      <div class="card">
        <h2>Kundendaten</h2>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px">
          <div><label for="name">Name*</label><input id="name" name="name" required></div>
          <div><label for="phone">Telefon*</label><input id="phone" name="phone" required></div>
          <div style="grid-column:1 / -1"><label for="email">E-Mail*</label><input id="email" name="email" type="email" required></div>
          <div style="grid-column:1 / -1"><label for="coupon">Gewinncode (optional)</label><input id="coupon" name="coupon" placeholder="z. B. Shop"></div>
        </div>
      </div>

      <div class="card">
        <h2>Produkte</h2>
        <div class="row">
          <div>
            <label for="p1Pack">Produkt 1: Glas-Tag</label>
            <select id="p1Pack" name="p1Pack">
              <option value="single">Einzel (1,50 ‚Ç¨ / St√ºck)</option>
              <option value="pack5">5er-Pack (4,95 ‚Ç¨ / Packung)</option>
              <option value="pack10">10er-Pack (9,95 ‚Ç¨ / Packung)</option>
            </select>
            <div class="muted" id="p1PiecesHint">Aktuell: 0 St√ºck</div>
          </div>
          <div><label for="p1Qty">Anzahl Packungen</label><input id="p1Qty" name="p1Qty" type="number" min="0" value="0"></div>
          <div><label>Zwischensumme</label><input id="p1Subtotal" type="text" value="0,00 ‚Ç¨" readonly></div>
        </div>

        <div id="p1NamesBlock" class="grid hidden">
          <label for="p1Names">Namen f√ºr die Glas-Tags (ein Name pro Zeile) *</label>
          <textarea id="p1Names" name="p1Names" rows="5" placeholder="z. B. Anna&#10;Ben&#10;Cem"></textarea>
          <div class="muted">Die Anzahl der Zeilen muss der Gesamt-St√ºckzahl entsprechen.</div>
          <div id="p1NamesError" class="error hidden">Anzahl der Namen passt nicht zur St√ºckzahl.</div>
        </div>

        <hr class="sep">

        <div class="row">
          <div>
            <label>Produkt 2: Deluxe Kakao</label>
            <div class="muted">St√ºckpreis: <span class="price-kakao" id="p2PriceLabel">5,00</span> ‚Ç¨</div>
          </div>
          <div><label for="p2Qty">Menge</label><input id="p2Qty" name="p2Qty" type="number" min="0" value="0"></div>
          <div><label>Zwischensumme</label><input id="p2Subtotal" type="text" value="0,00 ‚Ç¨" readonly></div>
        </div>

        <div class="totals"><div>Gesamt</div><div id="grandTotal">0,00 ‚Ç¨</div></div>
      </div>

      <div class="card">
        <h2>Warenkorb</h2>
        <div id="cartPreview" class="muted">Noch keine Artikel.</div>
      </div>

      <div class="grid" style="grid-template-columns: 1fr auto; gap:12px">
        <div class="muted">Nach dem Absenden erh√§ltst du eine Best√§tigungsmail mit dem Abholtermin. Keine Lieferung.</div>
        <button type="submit">Bestellung abschicken</button>
      </div>
      <div id="formError" class="error hidden" role="alert"></div>
      <div id="formOk" class="success hidden" role="status">Bestellung gesendet. Danke! Wir melden uns per E-Mail mit dem Abholtermin.</div>
    </form>

    <footer>
      <nav aria-label="Rechtliches">
        <a href="/impressum.html">Impressum</a> ¬∑ <a href="/datenschutz.html">Datenschutz</a>
      </nav>
    </footer>
  </main>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    /* ===== EmailJS + Preise ===== */
    const EMAILJS_PUBLIC_KEY="xAOygDJhZcJrXGuSb";
    const EMAILJS_SERVICE_ID="service_l642tri";
    const EMAILJS_TEMPLATE_ORDER="template_ggtexbv";
    const EMAILJS_TEMPLATE_CONFIRM="";
    const PRICES={p1:{single:1.50,pack5:4.95,pack10:9.95},p1PiecesPer:{single:1,pack5:5,pack10:10},p2:5.00};

    (function(){emailjs.init(EMAILJS_PUBLIC_KEY)})();
    const el=(id)=>document.getElementById(id);
    const formatEUR=(n)=>n.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
    const formatLines=(arr)=>arr.join(' | ');

    /* ===== Spiel ===== */
    const COLORS=["#e74c3c","#f39c12","#f1c40f","#2ecc71","#3498db","#9b59b6","#e67e22","#1abc9c","#e84393"];
    let board=[],revealed=new Set(),triesLeft=0,won=false;
    let gamesPlayed=0,startLocked=false,startCooldownTimer=null;
    let revealLock=false;

    function glassSVG(color){const c=color;return `<svg class="glass" viewBox="0 0 100 100" aria-hidden="true"><rect x="22" y="18" width="56" height="70" rx="10" ry="10" fill="url(#g1)" stroke="#d0d0d0" stroke-width="2"/><rect x="26" y="48" width="48" height="36" rx="8" ry="8" fill="${c}" opacity="0.9"/><rect x="26" y="22" width="8" height="52" rx="4" fill="#ffffff" opacity="0.35"/><g transform="translate(70,30)"><circle r="10" fill="#2d2d2d"/><circle r="3.2" cx="-3" cy="-3" fill="#d9d9d9"/></g><defs><linearGradient id="g1" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#fdfdfd"/><stop offset="1" stop-color="#efefef"/></linearGradient></defs></svg>`}
    function pickUnique(a,k){const c=a.slice().map(x=>({x,r:Math.random()})).sort((p,q)=>p.r-q.r).map(o=>o.x);return c.slice(0,k)}
    function newBoard(){ if(startLocked)return;
      const seven=pickUnique(COLORS,7);
      const winColor=seven[Math.floor(Math.random()*seven.length)];
      const tiles=[];for(let i=0;i<3;i++)tiles.push(winColor);
      const others=seven.filter(c=>c!==winColor).slice(0,6);tiles.push(...others);
      board=tiles.map(c=>({c,r:Math.random()})).sort((a,b)=>a.r-b.r).map(o=>o.c);
      revealed.clear();triesLeft=5;won=false;
      el('triesLeft').textContent=String(triesLeft);
      el('matchCount').textContent="0";
      el('gameMsg').textContent="";
      renderBoard();
      el('startGameBtn').classList.add('hidden');
      el('newGameBtn').classList.remove('hidden');
      el('cooldownPill').classList.add('hidden');
    }
    function renderBoard(){
      const grid=el('gameGrid');grid.innerHTML="";
      board.forEach((color,i)=>{
        const tile=document.createElement('button');
        tile.type='button'; tile.className='tile';
        tile.dataset.index=String(i);
        tile.setAttribute('aria-label','verdeckt');
        tile.innerHTML = glassSVG(color);
        const cover=document.createElement('div'); cover.className='cover'; cover.style.opacity='1'; cover.style.transition='opacity .18s ease';
        tile.appendChild(cover);
        tile.addEventListener('pointerdown', (evt)=> onReveal(evt, tile), {passive:false});
        grid.appendChild(tile);
      });
    }
    function onReveal(e, tile){
      e.preventDefault(); e.stopPropagation();
      if (revealLock) return;
      const idx=Number(tile.dataset.index);
      if(won || triesLeft<=0 || revealed.has(idx)) return;
      revealLock=true; setTimeout(()=>{revealLock=false},180);
      revealed.add(idx); triesLeft--; el('triesLeft').textContent=String(triesLeft);
      tile.classList.add('revealed'); const cover=tile.querySelector('.cover'); cover.style.opacity='0';
      const counts={}; revealed.forEach(i=>{ const c=board[i]; counts[c]=(counts[c]||0)+1; });
      const maxSame=Math.max(...Object.values(counts)); el('matchCount').textContent=String(maxSame);
      if(maxSame>=3){ won=true; el('gameMsg').innerHTML=`<span class="win">Gewonnen! üéâ Glas-Tag gratis.</span>`;
        const couponEl=el('coupon'); if(couponEl && !couponEl.value.trim()){ couponEl.value='Shop'; recalc(); }
        endGameStartCooldown(); return; }
      if(triesLeft===0){ el('gameMsg').innerHTML=`<span class="lose">Leider verloren.</span>`; endGameStartCooldown(); }
    }
    function endGameStartCooldown(){
      gamesPlayed += 1; const delaySec = gamesPlayed * 5; startLocked = delaySec > 0;
      const startBtn = el('startGameBtn'); const newBtn   = el('newGameBtn');
      startBtn.classList.remove('hidden'); newBtn.classList.add('hidden');
      if (!startLocked) return; startBtn.classList.add('disabled');
      const pill = el('cooldownPill'); const out  = el('cooldownSec'); pill.classList.remove('hidden');
      let remain = delaySec; out.textContent = String(remain);
      clearInterval(startCooldownTimer);
      startCooldownTimer = setInterval(()=>{
        remain -= 1; if (remain <= 0){ clearInterval(startCooldownTimer); startLocked = false; pill.classList.add('hidden'); startBtn.classList.remove('disabled'); }
        else { out.textContent = String(remain); }
      }, 1000);
    }

    /* ===== Warenkorb-Berechnung ===== */
    function recalc(){
      const pack=el('p1Pack').value;
      const p1Qty=Math.max(0,parseInt(el('p1Qty').value||'0',10));
      const p2Qty=Math.max(0,parseInt(el('p2Qty').value||'0',10));
      const p1Pieces = PRICES.p1PiecesPer[pack]*p1Qty; el('p1PiecesHint').textContent=`Aktuell: ${p1Pieces} St√ºck`;
      const p1Subtotal=PRICES.p1[pack]*p1Qty; const p2Subtotal=PRICES.p2*p2Qty; const total=p1Subtotal+p2Subtotal;
      el('p1Subtotal').value=formatEUR(p1Subtotal); el('p2Subtotal').value=formatEUR(p2Subtotal); el('grandTotal').textContent=formatEUR(total);
      if(p1Pieces>0){ el('p1NamesBlock').classList.remove('hidden'); } else { el('p1NamesBlock').classList.add('hidden'); el('p1Names').value=''; el('p1NamesError').classList.add('hidden'); }
      const lines=[]; if(p1Qty>0){ const packLabel=pack==='single'?'Einzel':(pack==='pack5'?'5er-Pack':'10er-Pack'); lines.push(`Produkt 1 (Glas-Tag) ‚Äì ${packLabel} √ó ${p1Qty} = ${formatEUR(p1Subtotal)} (= ${p1Pieces} St√ºck)`); }
      if(p2Qty>0) lines.push(`Produkt 2 (Deluxe Kakao) √ó ${p2Qty} = ${formatEUR(p2Subtotal)}`);
      const coupon = el('coupon').value.trim(); if(coupon) lines.push(`Gewinncode: ${coupon}`);
      el('cartPreview').textContent = lines.length ? formatLines(lines) : 'Noch keine Artikel.';
    }
    function validate(){
      if(el('hp_field').value) return {ok:false,msg:'Spam erkannt.'};
      const name=el('name').value.trim(); const phone=el('phone').value.trim(); const email=el('email').value.trim();
      const pack=el('p1Pack').value; const p1Qty=Math.max(0,parseInt(el('p1Qty').value||'0',10)); const p2Qty=Math.max(0,parseInt(el('p2Qty').value||'0',10));
      const p1Pieces=PRICES.p1PiecesPer[pack]*p1Qty;
      if(!name||!phone||!email) return {ok:false,msg:'Bitte Name, Telefon und E-Mail ausf√ºllen.'};
      if(p1Qty+p2Qty===0) return {ok:false,msg:'Bitte mindestens ein Produkt ausw√§hlen.'};
      if(p1Pieces>0){
        const names=el('p1Names').value.split('\n').map(s=>s.trim()).filter(Boolean);
        if(names.length!==p1Pieces){ el('p1NamesError').classList.remove('hidden'); return {ok:false,msg:`Anzahl der Glas-Tag-Namen (${names.length}) passt nicht zur St√ºckzahl (${p1Pieces}).`}; }
        else { el('p1NamesError').classList.add('hidden'); }
      }
      return {ok:true};
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // Spiel
      el('startGameBtn').addEventListener('click', newBoard);
      el('newGameBtn').addEventListener('click', newBoard);
      ['p1Pack','p1Qty','p2Qty','coupon'].forEach(id=>el(id).addEventListener('input',recalc));
      recalc();

      document.getElementById('orderForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        el('formError').classList.add('hidden'); el('formOk').classList.add('hidden');

        const v=validate(); if(!v.ok){ el('formError').textContent=v.msg; el('formError').classList.remove('hidden'); return; }

        const pack=el('p1Pack').value;
        const p1Qty=Math.max(0,parseInt(el('p1Qty').value||'0',10));
        const p2Qty=Math.max(0,parseInt(el('p2Qty').value||'0',10));
        const p1Pieces=PRICES.p1PiecesPer[pack]*p1Qty;
        const p1SubtotalVal=PRICES.p1[pack]*p1Qty; const p2SubtotalVal=PRICES.p2*p2Qty;

        const cartLines=[];
        if(p1Qty>0){ const packLabel=pack==='single'?'Einzel':(pack==='pack5'?'5er-Pack':'10er-Pack'); cartLines.push(`Produkt 1 (Glas-Tag) ‚Äì ${packLabel} √ó ${p1Qty} = ${formatEUR(p1SubtotalVal)} (= ${p1Pieces} St√ºck)`); }
        if(p2Qty>0) cartLines.push(`Produkt 2 (Deluxe Kakao) √ó ${p2Qty} = ${formatEUR(p2SubtotalVal)}`);
        const coupon=el('coupon').value.trim(); if(coupon) cartLines.push(`Gewinncode: ${coupon}`);

        const fullName = el('name').value.trim();
        const nameParts = fullName.split(" ");

        const orderPayload = {
          vorname: nameParts[0] || fullName,
          nachname: nameParts.slice(1).join(" ") || "-",
          kunden_email: el('email').value.trim(),
          telefon: el('phone').value.trim(),
          artikel_zeilen: cartLines.join("\n"),
          gesamtpreis: el('grandTotal').textContent,
          hinweise: el('p1Names').value.trim() || "-",
          abholtermin: "Wird per E-Mail abgestimmt.",
          reply_to: el('email').value.trim(),

          from_name: fullName,
          to_name: "OBS-Die-Firma",
          message: `Neue Bestellung

Name: ${fullName}
E-Mail: ${el('email').value.trim()}
Telefon: ${el('phone').value.trim()}

Artikel:
${cartLines.join("\n")}

Gesamtpreis: ${el('grandTotal').textContent}

Namen/Infos:
${(el('p1Names').value || "-").trim()}

Abholtermin: Wird per E-Mail abgestimmt.`
        };

        try{
          const r1 = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ORDER, orderPayload);

          if (EMAILJS_TEMPLATE_CONFIRM && EMAILJS_TEMPLATE_CONFIRM.trim() !== "") {
            const confirmPayload = {
              to_email: orderPayload.kunden_email,
              to_name: orderPayload.vorname,
              vorname: orderPayload.vorname,
              artikel_zeilen: orderPayload.artikel_zeilen,
              gesamtpreis: orderPayload.gesamtpreis,
              abholhinweis: "Wir melden uns mit einem Abholtermin per E-Mail.",
              firma: "OBS-Die-Firma",
              from_name: "OBS-Die-Firma",
              message: `Hallo ${orderPayload.vorname},

wir haben deine Bestellung erhalten.

Artikel:
${orderPayload.artikel_zeilen}

Gesamtpreis: ${orderPayload.gesamtpreis}
Wir melden uns mit einem Abholtermin per E-Mail.

Liebe Gr√º√üe
OBS-Die-Firma`
            };
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_CONFIRM, confirmPayload);
          }

          if(r1 && r1.status>=200 && r1.status<300){ el('formOk').classList.remove('hidden'); }
          else { throw new Error('EmailJS: unerwartete Antwort'); }

        }catch(err){
          console.error(err);
          el('formError').textContent='Senden fehlgeschlagen. Pr√ºfe EmailJS IDs/Template.';
          el('formError').classList.remove('hidden');
        }
      });

      /* ===== Sternenhimmel initialisieren ===== */
      initStars();
    });

    /* ===== LOKALER TICKER ===== */
    const TICKER_URL = "/ticker.json?ts=" + Date.now();
    const CACHE_KEY = "localTickerCache_v1";
    const CACHE_TTL_MS = 24 * 60 * 60 * 1000;
    const TIMEOUT_MS = 8000;
    const MAX_RETRY = 2;

    const euro0 = (n) => new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(n);

    function renderTicker(items, fromCache=false){
      const mk = (it) => {
        const text = it.text || "";
               const url  = it.url;
        const val  = (typeof it.value === "number") ? ` <strong>${euro0(it.value)}</strong>` : "";
        const extra= it.extra ? ` <small>${it.extra}</small>` : "";
        if (url) return `<span class="ticker-item">‚Ä¢ <a href="${url}" target="_blank" rel="noreferrer">${text}</a>${val}${extra}</span>`;
        return `<span class="ticker-item">‚Ä¢ ${text}${val}${extra}</span>`;
      };
      const html = items.map(mk);
      const track = document.getElementById("tickerTrack");
      if (track) track.innerHTML = html.concat(html).join("") + (fromCache ? `<span class="ticker-item">(Cache)</span>` : "");
    }

    function tryRenderFromCache(){
      try{
        const raw = localStorage.getItem(CACHE_KEY);
        if(!raw) return false;
        const {ts,items} = JSON.parse(raw);
        if(!Array.isArray(items) || (Date.now()-ts)>CACHE_TTL_MS) return false;
        renderTicker(items,true);
        return true;
      }catch{ return false; }
    }

    async function fetchJSON(url, {timeout=TIMEOUT_MS, retries=MAX_RETRY} = {}){
      let lastErr;
      for(let attempt=0; attempt<=retries; attempt++){
        const ac = new AbortController();
        const timer = setTimeout(()=>ac.abort(new DOMException(`Timeout nach ${timeout}ms`,"TimeoutError")), timeout);
        try{
          const r = await fetch(url, {signal: ac.signal, cache: "no-store"});
          clearTimeout(timer);
          if(!r.ok) throw new Error(`HTTP ${r.status}`);
          return await r.json();
        }catch(e){
          clearTimeout(timer);
          lastErr = e;
          if(attempt<retries) await new Promise(res=>setTimeout(res, 400*(attempt+1)));
        }
      }
      throw lastErr;
    }

    async function loadLocalTicker(){
      tryRenderFromCache();
      const data = await fetchJSON(TICKER_URL);
      if(!data || !Array.isArray(data.items) || data.items.length===0) throw new Error("Ung√ºltiges ticker.json Format");
      renderTicker(data.items);
      try{ localStorage.setItem(CACHE_KEY, JSON.stringify({ts:Date.now(), items:data.items})); }catch{}
    }

    (async () => {
      const track = document.getElementById("tickerTrack");
      if (track) track.textContent = "Lade Neuigkeiten ‚Ä¶";
      try { await loadLocalTicker(); }
      catch (err) {
        console.error("Ticker-Fehler:", err);
        if(!tryRenderFromCache()){
          const t = document.getElementById("tickerTrack");
          if (t) {
            const msg = ['‚ö†Ô∏è Ticker-Error', navigator.onLine?'(online)':'(offline)', (err && err.message)?'¬∑ '+err.message:''].join(' ');
            t.innerHTML = `
              <span class="ticker-item">${msg}</span>
              <span class="ticker-item">Hinweis: <code>ticker.json</code> fehlt oder ist ung√ºltig.</span>
            `;
          }
        }
      }
      setInterval(()=>loadLocalTicker().catch(()=>{}), 24*60*60*1000);
    })();

    /* ===== Sternenhimmel ===== */
    function initStars(){
      const layer = el('starsLayer');
      if(!layer) return;
      layer.innerHTML = '';

      const W = layer.clientWidth || window.innerWidth;
      const H = layer.clientHeight || 400; // H√∂he der Sky-Box

      const STAR_COUNT = 120; // angenehm ruhig
      for(let i=0;i<STAR_COUNT;i++){
        const s = document.createElement('span');
        s.className = 'star';
        const x = Math.random()*W;
        const y = Math.random()*H;
        const size = Math.random() < 0.15 ? 3 : 2; // ein paar gr√∂√üere
        const delay = (Math.random()*6).toFixed(2)+'s';
        const dur = (3+Math.random()*5).toFixed(2)+'s';
        s.style.left = x+'px';
        s.style.top = y+'px';
        s.style.width = size+'px';
        s.style.height = size+'px';
        s.style.setProperty('--twDelay', delay);
        s.style.setProperty('--twDur', dur);
        layer.appendChild(s);
      }

      // alle 6‚Äì12s gelegentlich eine Sternschnuppe
      function spawnShootingStar(){
        const shoot = document.createElement('div');
        shoot.className = 'shooting';
        // Start eher rechts oben
        const startX = (layer.clientWidth || window.innerWidth) * (0.55 + Math.random()*0.35);
        const startY = 20 + Math.random()*80;
        const dx = - (400 + Math.random()*420);
        const dy = 120 + Math.random()*220;
        const rot = (-12 - Math.random()*18) + 'deg';

        shoot.style.left = startX+'px';
        shoot.style.top = startY+'px';
        shoot.style.setProperty('--dx', dx+'px');
        shoot.style.setProperty('--dy', dy+'px');
        shoot.style.setProperty('--rot', rot);

        layer.appendChild(shoot);
        shoot.addEventListener('animationend', ()=> shoot.remove());

        const nextIn = 6000 + Math.random()*6000;
        setTimeout(spawnShootingStar, nextIn);
      }
      // Erste Sternschnuppe leicht verz√∂gert
      setTimeout(spawnShootingStar, 3000 + Math.random()*4000);

      // Reflow bei Resize
      let resizeTO;
      window.addEventListener('resize', ()=>{
        clearTimeout(resizeTO);
        resizeTO = setTimeout(()=>initStars(), 400);
      }, {passive:true});
    }
  </script>
</body>
</html>
