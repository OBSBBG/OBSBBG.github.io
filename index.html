<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>OBS-Die-Firma – Shop</title>
  <meta name="description" content="Schülerfirma OBS-Die-Firma: Glas-Tags & Deluxe Kakao. Jetzt bestellen und abholen.">
  <meta name="theme-color" content="#0b5d2a">
  <style>
    :root{
      color-scheme: light dark;
      --bg: #0b5d2a;
      --card:#ffffff;
      --ink:#121212;
      --muted:#616161;
      --acc:#0c8a43;
      --warn:#b3261e;
      --ok:#0b7a0b;
      --price:#d40000;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height:1.35;
      background:
        radial-gradient(1000px 500px at 5% -10%, rgba(12,138,67,.25), transparent 60%),
        radial-gradient(900px 500px at 95% -20%, rgba(12,138,67,.18), transparent 60%),
        #f6f8f7;
      color: var(--ink);
      padding: 1.5rem;
    }
    main{max-width: 1100px; margin: 0 auto;}
    header{display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:1.25rem}
    h1{margin:0; font-size:clamp(1.5rem, 2.5vw, 2.1rem)}
    .wrap{display:grid; grid-template-columns: 1.2fr .8fr; gap:1rem}
    .card{
      background:var(--card); border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.08);
      padding:1rem
    }
    .products{display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:.75rem}
    .p{border:1px solid #e7e7e7; border-radius:14px; padding:.75rem; display:grid; gap:.5rem}
    .p h3{margin:.2rem 0; font-size:1.05rem}
    .p .price{color:var(--price); font-weight:700}
    .qty{display:flex; gap:.5rem; align-items:center}
    .qty input{width:72px; padding:.4rem .5rem; border:1px solid #d0d0d0; border-radius:10px; font:inherit}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      border:none; border-radius:12px; padding:.55rem .8rem; font:inherit; cursor:pointer;
      background:var(--acc); color:white; font-weight:600
    }
    .btn.secondary{background:#eeeeee; color:#111}
    .btn.block{width:100%}
    .cart{display:grid; gap:.5rem}
    .cart ul{list-style:none; margin:0; padding:0; display:grid; gap:.4rem; max-height:260px; overflow:auto}
    .row{display:grid; grid-template-columns: 1fr auto auto; gap:.5rem; align-items:center}
    .muted{color:var(--muted)}
    .total{display:flex; align-items:center; justify-content:space-between; font-weight:700; padding-top:.5rem; border-top:1px dashed #ddd}
    form{display:grid; gap:.6rem}
    label{font-size:.92rem}
    input, textarea, select{
      width:100%; padding:.55rem .7rem; border:1px solid #d0d0d0; border-radius:10px; font:inherit
    }
    .two{display:grid; grid-template-columns:1fr 1fr; gap:.6rem}
    .status{margin-top:.6rem; font-size:.95rem}
    .status.error{color:var(--warn)}
    .status.ok{color:var(--ok)}
    .hint{font-size:.85rem; color:var(--muted)}
    footer{margin-top:1rem; text-align:center; font-size:.85rem; color:var(--muted)}
    @media (max-width: 900px){ .wrap{grid-template-columns:1fr} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
<main>
  <header>
    <h1>OBS-Die-Firma – Webshop</h1>
    <div class="muted">Bestellung ohne Login • Abholung in der Schule</div>
  </header>

  <div class="wrap">
    <!-- Produkte -->
    <section class="card">
      <h2 style="margin-top:.2rem">Produkte</h2>
      <div class="products" id="products"></div>
      <div class="hint" style="margin-top:.5rem">
        Mengen anpassen, dann „In den Warenkorb“. Preise inkl. USt. Abholung nach Bestätigung.
      </div>
    </section>

    <!-- Warenkorb + Formular -->
    <aside class="card">
      <h2 style="margin-top:.2rem">Warenkorb & Bestellung</h2>

      <div class="cart">
        <ul id="cartList"></ul>
        <div class="total">
          <span>Gesamt</span>
          <span id="total">€ 0,00</span>
        </div>
        <button class="btn secondary" id="btnClear" type="button">Warenkorb leeren</button>
      </div>

      <hr style="margin:1rem 0; border:none; border-top:1px solid #eee">

      <form id="orderForm" novalidate>
        <div class="two">
          <div>
            <label for="vorname">Vorname *</label>
            <input id="vorname" name="vorname" autocomplete="given-name" required>
          </div>
          <div>
            <label for="nachname">Nachname *</label>
            <input id="nachname" name="nachname" autocomplete="family-name" required>
          </div>
        </div>

        <div>
          <label for="email">E-Mail *</label>
          <input id="email" name="email" type="email" autocomplete="email" required>
        </div>

        <div>
          <label for="telefon">Telefon *</label>
          <input id="telefon" name="telefon" type="tel" autocomplete="tel" required>
        </div>

        <div>
          <label for="abholtermin">Wunschtermin (optional)</label>
          <input id="abholtermin" name="abholtermin" type="date">
        </div>

        <div>
          <label for="hinweise">Hinweise (z. B. Namen für Glas-Tags)</label>
          <textarea id="hinweise" name="hinweise" rows="3" placeholder="Beispiel: Anna, Ben, Chris – bitte in Pink."></textarea>
        </div>

        <div class="hint">Mit * markierte Felder sind Pflicht. Deine Daten werden nur zur Abwicklung dieser Bestellung genutzt.</div>

        <button class="btn block" id="btnSubmit" type="submit">Verbindlich bestellen & per E-Mail senden</button>
        <div id="status" class="status"></div>
      </form>
    </aside>
  </div>

  <footer>
    © OBS-Die-Firma • GitHub Pages • Keine Server-Datenbank – Versand via EmailJS
  </footer>
</main>

<script>
  // ======= 1) Produkte konfigurieren =======
  const PRODUCTS = [
    { id: 'glas-tag',    name: 'Glas-Tag (individuell)', price: 1.50 },
    { id: 'deluxe-kakao',name: 'Deluxe Kakao (Schokobombe)', price: 5.00 },
    // weitere Produkte hier ergänzen …
  ];

  // ======= 2) Warenkorb =======
  const cart = new Map();
  const fmt = (n) => new Intl.NumberFormat('de-DE', { style:'currency', currency:'EUR' }).format(n);

  function renderProducts() {
    const box = document.getElementById('products');
    box.innerHTML = '';
    PRODUCTS.forEach(p => {
      const el = document.createElement('article');
      el.className = 'p';
      el.innerHTML = `
        <h3>${p.name}</h3>
        <div class="price">${fmt(p.price)}</div>
        <div class="qty">
          <label for="qty-${p.id}" class="muted" style="min-width:72px">Menge:</label>
          <input id="qty-${p.id}" type="number" min="1" step="1" value="1" inputmode="numeric" pattern="[0-9]*">
        </div>
        <button class="btn" data-add="${p.id}">In den Warenkorb</button>
      `;
      box.appendChild(el);
    });
    box.querySelectorAll('button[data-add]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-add');
        const qty = Math.max(1, parseInt(document.getElementById(`qty-${id}`).value || '1', 10));
        addToCart(id, qty);
      });
    });
  }

  function addToCart(id, qty){
    const p = PRODUCTS.find(x => x.id === id);
    if(!p) return;
    const prev = cart.get(id);
    const newQty = (prev?.qty || 0) + qty;
    cart.set(id, { ...p, qty:newQty });
    renderCart();
  }
  function removeFromCart(id){ cart.delete(id); renderCart(); }
  function clearCart(){ cart.clear(); renderCart(); }

  function renderCart(){
    const list = document.getElementById('cartList');
    list.innerHTML = '';
    let sum = 0;
    cart.forEach(item => {
      const lineSum = item.qty * item.price;
      sum += lineSum;
      const row = document.createElement('li');
      row.className = 'row';
      row.innerHTML = `
        <div>${item.name} <span class="muted">× ${item.qty}</span></div>
        <div class="muted">${fmt(item.price)}</div>
        <button type="button" class="btn secondary" data-remove="${item.id}">Entfernen</button>
      `;
      list.appendChild(row);
    });
    document.getElementById('total').textContent = fmt(sum);
    list.querySelectorAll('button[data-remove]').forEach(b => b.addEventListener('click', () => removeFromCart(b.getAttribute('data-remove'))));
  }

  // ======= 3) EmailJS – deine echten IDs =======
  const EMAILJS_PUBLIC_KEY  = 'xAOygDJhZcJrXGuSb';
  const EMAILJS_SERVICE_ID  = 'service_l642tri';
  const EMAILJS_TEMPLATE_ID = 'template_ggtexbv';
  emailjs.init(EMAILJS_PUBLIC_KEY);

  // ======= 4) Versand =======
  const form = document.getElementById('orderForm');
  const statusBox = document.getElementById('status');
  const btnSubmit = document.getElementById('btnSubmit');

  function setStatus(msg, ok=false){
    statusBox.textContent = msg;
    statusBox.className = 'status ' + (ok ? 'ok' : 'error');
  }
  function buildArtikelZeilen(){
    if(cart.size===0) return '(leer)';
    let i=1, lines=[];
    cart.forEach(it => {
      lines.push(`${i}. ${it.name} × ${it.qty} — Einzel: ${fmt(it.price)} — Summe: ${fmt(it.qty*it.price)}`);
      i++;
    });
    return lines.join('\n');
  }
  function calcGesamt(){ let s=0; cart.forEach(i=>s+=i.qty*i.price); return s; }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(cart.size===0){ setStatus('Warenkorb ist leer.'); return; }

    const vorname = document.getElementById('vorname').value.trim();
    const nachname = document.getElementById('nachname').value.trim();
    const kunden_email = document.getElementById('email').value.trim();
    const telefon = document.getElementById('telefon').value.trim();
    const abholtermin = document.getElementById('abholtermin').value.trim();
    const hinweise = document.getElementById('hinweise').value.trim();

    if(!vorname || !nachname || !kunden_email || !telefon){
      setStatus('Bitte alle Pflichtfelder ausfüllen.'); return;
    }

    const templateParams = {
      vorname,
      nachname,
      kunden_email,
      telefon,
      artikel_zeilen: buildArtikelZeilen(),
      gesamtpreis: new Intl.NumberFormat('de-DE', { style:'currency', currency:'EUR' }).format(calcGesamt()),
      abholtermin: abholtermin || '—',
      hinweise: hinweise || '—',
      reply_to: kunden_email // damit Antworten an den Kunden gehen
    };

    btnSubmit.disabled = true;
    const orig = btnSubmit.textContent;
    btnSubmit.textContent = 'Sende …';
    setStatus('');

    try{
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
      setStatus('Bestellung gesendet. Du erhältst eine Bestätigung per E-Mail.', true);
      form.reset(); clearCart();
    }catch(err){
      console.error(err);
      setStatus('Senden fehlgeschlagen. Prüfe Service/Template oder versuche es später erneut.');
    }finally{
      btnSubmit.disabled = false;
      btnSubmit.textContent = orig;
    }
  });

  // ======= 5) Start =======
  renderProducts();
  renderCart();
  document.getElementById('btnClear').addEventListener('click', clearCart);
</script>
</body>
</html>
