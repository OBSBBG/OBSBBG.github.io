<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OBS-Die-Firma – Sortiment</title>
  <meta name="description" content="OBS-Die-Firma: Glas-Tags & Deluxe Kakao. Jetzt bestellen und in der Schülerfirma abholen.">
  <meta name="theme-color" content="#003b1f">

  <!-- Moderne Schrift -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Edel/Dekorativ -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <style>

    /* ------------------------------------------ */
    /* FIX FÜR FALSCHE ANZEIGE VON „Gesendet…“   */
    /* ------------------------------------------ */
    .hidden {
      display: none !important;
    }

    :root{
      color-scheme:light dark;
      --accent-green:#0c8a43;
      --green:#34c759;
      --deep-green:#0b5d2a;
      --gold:#d4af37;
      --price:#d40000;
      --ink:#161817;
      --ink-2:#2a2f2b;
      --muted:#5b625e;
      --border:#e6e9e7;
      --surface:#ffffff;
      --ring:#98e1b3;
    }
    *{box-sizing:border-box}
    html,body{overscroll-behavior-y:contain}

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:start center;
      font-family:"Inter",system-ui,Arial,sans-serif;
      font-size:16.5px;
      -webkit-font-smoothing:antialiased;
      color:var(--ink);
      letter-spacing:.005em;
      line-height:1.55;
      background:#fff;
      padding:2rem;
    }

    main{width:min(1000px,100%)}


    /* ----------------------------- */
    /* TICKER */
    /* ----------------------------- */

    .ticker{width:100%;overflow:hidden;margin:-.5rem 0 1.25rem 0}
    .ticker-bar{
      background:linear-gradient(90deg,#2fb457,#0c8a43);
      color:#fff;font-weight:700;
      padding:.8rem 0;
      border-radius:12px;
    }
    .ticker-track{
      display:inline-block;white-space:nowrap;
      animation:ticker 120s linear infinite;
    }
    .ticker-item{display:inline-flex;gap:.45rem;margin:0 1.6rem}
    @keyframes ticker{
      0%{transform:translateX(100%)}
      100%{transform:translateX(-100%)}
    }

    /* ----------------------------- */
    /* HERO / NACHT */
    /* ----------------------------- */

    .hero{margin:0 0 1.6rem;text-align:center;position:relative;}

    .night-sky{
      position:absolute;
      left:50%;transform:translateX(-50%);
      top:-26vh;width:120vw;height:56vh;
      pointer-events:none;
      background:#02070d;
    }
    .stars{position:absolute;inset:0}
    .star{
      position:absolute;width:2px;height:2px;border-radius:50%;
      background:white;opacity:.9;
      animation:twinkle 4s ease-in-out infinite alternate;
    }
    @keyframes twinkle{
      0%{opacity:.25;transform:scale(.9)}
      100%{opacity:1;transform:scale(1.2)}
    }

    .brand-wrap{position:relative;display:inline-block;z-index:1}
    .brand{
      margin:0;font-weight:900;
      text-transform:uppercase;
      font-size:clamp(3rem,12vw,6.6rem);
      background:linear-gradient(180deg,#0b5d2a,#0c8a43 40%,#34c759 80%);
      -webkit-background-clip:text;
      color:transparent;
    }
    .brand-underline{
      width:min(520px,74%);
      height:8px;margin:.7rem auto 0;
      background:linear-gradient(90deg,#34c759,#0c8a43,#34c759);
      border-radius:999px;
    }
    .tagline{
      margin:.9rem 0 0;
      font-weight:800;
      text-transform:uppercase;
      color:#183c26;
      opacity:.9;
    }

    /* ----------------------------- */
    /* ÜBER UNS */
    /* ----------------------------- */

    .about{
      text-align:center;
      margin:1.4rem auto 2rem;
      font-family:"Playfair Display";
      color:var(--deep-green);
    }
    .about .ornament{
      width:140px;height:3px;margin:.6rem auto;
      background:linear-gradient(90deg,var(--gold),#fff8d0,var(--gold));
      border-radius:999px;
    }

    /* ----------------------------- */
    /* PRODUKTE */
    /* ----------------------------- */

    .slot{
      border:1px solid var(--border);
      border-radius:16px;
      padding:1.2rem;
      background:#fff;
      box-shadow:0 8px 20px rgba(0,0,0,.05);
      display:flex;
      flex-direction:column;
    }
    .slot-body{
      display:grid;
      grid-template-columns:64px 1fr;
      gap:12px;
    }
    .idx{
      width:64px;min-height:72px;
      background:#0c8a43;
      color:#fff;font-weight:900;
      display:flex;align-items:center;justify-content:center;
      border-radius:14px;
    }

    .slots{
      margin-top:1.5rem;
      display:grid;
      gap:1rem;
    }
    @media(min-width:720px){
      .slots{grid-template-columns:1fr 1fr;}
    }

    /* ----------------------------- */
    /* PRODUKT 3 – FIXED VERSION     */
    /* ----------------------------- */

    .product3-images{
      position:relative;
      margin:1rem auto 0;
      max-width:420px;
      padding-bottom:160px; /* Platz für TAG6 */
    }

    .product3-main{
      width:100%;border-radius:12px;
      box-shadow:0 8px 22px rgba(0,0,0,.15);
    }

    .product3-overlay,
    .product3-tag5,
    .product3-tag6{
      width:42%;
      border-radius:12px;
      box-shadow:0 8px 22px rgba(0,0,0,.25);
      position:absolute;
    }

    .product3-overlay{
      right:-18%;bottom:-22%;
    }

    .product3-tag5{
      left:-18%;bottom:-22%;
    }

    .product3-tag6{
      left:50%;transform:translateX(-50%);
      bottom:-55%;
    }

    img{
      display:block;
      max-width:100%;
      border-radius:12px;
      box-shadow:0 8px 20px rgba(0,0,0,.1);
      margin-top:1rem;
    }

    /* ----------------------------- */
    /* FORM / BESTELLUNG (Fix Version) */
    /* ----------------------------- */

    .card{
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      margin-top:16px;
      background:#fff;
      box-shadow:0 6px 16px rgba(0,0,0,.05);
      position:relative;
      z-index:5;
    }

    .grid{display:grid;gap:12px}
    .row{
      display:grid;
      grid-template-columns:1fr 140px 160px;
      gap:10px;
    }

    label{font-weight:600}
    input,textarea,select{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      border-radius:10px;
    }

    button{
      padding:12px 18px;
      border:0;
      border-radius:12px;
      background:#0c8a43;
      color:#fff;font-weight:800;
      cursor:pointer;
    }

    .muted{color:var(--muted)}
    .error{color:#b00020;font-weight:700}
    .success{color:#0a7a30;font-weight:800}

  </style>
</head>


<body>

<!-- ===== TICKER ===== -->
<div class="ticker">
  <div class="ticker-bar">
    <div id="tickerTrack" class="ticker-track">Lade Neuigkeiten …</div>
  </div>
</div>

<main>
  <header class="hero">
    <div class="night-sky"><div class="stars" id="starsLayer"></div></div>
    <div class="brand-wrap"><h1 class="brand">OBS-Die-Firma</h1></div>
    <div class="brand-underline"></div>
    <div class="tagline">Sortiment</div>
  </header>

  <section class="about">
    <h2>Wer wir sind</h2>
    <div class="ornament"></div>
    <p>Unsere Schülerfirma ist ein Projekt des WPK Jahrgang 10 – ergänzt durch freiwillige Mitgestaltende.</p>
    <p>Gewinne fließen vollständig zurück ins Projekt.</p>
  </section>

  <!-- PRODUKT 1 -->
  <article class="slot">
    <div class="slot-body">
      <div class="idx">#1</div>
      <div>
        <h2>Personalisierter Glas-Tag <span class="badge">*</span></h2>
        <p><strong>Das praktische Gadget</strong> für Feiern und gesellige Runden.</p>
        <p style="margin-top:.6rem">Vorher: <span class="price-old">3 €</span></p>
        <ul class="price-list">
          <li>Einzel: <span class="price-new">1,50 €</span></li>
          <li>5er-Pack: <span class="price-new">4,95 €</span></li>
          <li>10er-Pack: <span class="price-new">9,95 €</span></li>
        </ul>
      </div>
    </div>
    <img src="Tag.jpeg" alt="Glas-Tag">
  </article>

  <section class="slots">

    <!-- PRODUKT 2 -->
    <article class="slot">
      <div class="slot-body">
        <div class="idx">#2</div>
        <div>
          <h2>Deluxe Kakao „Chocolate Bomb“</h2>
          <p><strong>Mit Glas:</strong> heiß aufgießen → cremiger Kakao.</p>
          <p class="price-new" style="margin-top:.6rem">Preis: 5,00 €</p>
        </div>
      </div>
      <img src="Tag2.jpeg" alt="Chocolate Bomb">
    </article>

    <!-- PRODUKT 3 (mit TAG5 & TAG6) -->
    <article class="slot">
      <div class="slot-body">
        <div class="idx">#3</div>
        <div>
          <h2>Instant Kakao „Schneemann“</h2>
          <p>Mit heißer Milch übergießen – süß & cremig.</p>
          <p class="price-new" style="margin-top:.6rem">Preis: 5,00 €</p>
        </div>
      </div>

      <div class="product3-images">
        <img src="Schneemann2.jpeg" class="product3-main">
        <img src="Schneemann1.jpeg" class="product3-overlay">
        <img src="TAG5.jpeg" class="product3-tag5">
        <img src="TAG6.jpeg" class="product3-tag6">
      </div>
    </article>

  </section>
  <!-- ===== Gewinnspiel ===== -->
  <section class="card">
    <h2>Werbeaktion: Gewinne einen Glas-Tag</h2>
    <p>Decke in 5 Versuchen drei gleichfarbige Gläser auf.</p>

    <div class="game-controls">
      <button type="button" id="startGameBtn">Spiel starten</button>
      <button type="button" id="newGameBtn" class="hidden">Neues Spiel</button>
      <span class="pill">Versuche: <span id="triesLeft">–</span></span>
      <span class="pill">Treffer: <span id="matchCount">0</span></span>
      <span class="pill hidden" id="cooldownPill">Warte <span id="cooldownSec">0</span>s</span>
    </div>

    <div id="gameGrid" class="game-grid"></div>
    <div id="gameMsg" style="margin-top:8px;"></div>
  </section>


  <!-- ===== BESTELLFORMULAR ===== -->
  <form id="orderForm" class="shop" novalidate>

    <input type="text" id="hp_field" name="company" style="position:absolute;left:-9999px">

    <!-- Kundendaten -->
    <div class="card">
      <h2>Kundendaten</h2>

      <div class="grid" style="grid-template-columns:1fr 1fr">
        <div>
          <label for="name">Name*</label>
          <input id="name" required>
        </div>
        <div>
          <label for="phone">Telefon*</label>
          <input id="phone" required>
        </div>
        <div style="grid-column:1/-1">
          <label for="email">E-Mail*</label>
          <input id="email" type="email" required>
        </div>
        <div style="grid-column:1/-1">
          <label for="coupon">Gewinncode (optional)</label>
          <input id="coupon">
        </div>
      </div>
    </div>


    <!-- Produkte -->
    <div class="card">
      <h2>Produkte</h2>

      <!-- Produkt 1 -->
      <div class="row">
        <div>
          <label for="p1Pack">Produkt 1</label>
          <select id="p1Pack">
            <option value="single">Einzel (1,50 €)</option>
            <option value="pack5">5er-Pack (4,95 €)</option>
            <option value="pack10">10er-Pack (9,95 €)</option>
          </select>
          <div class="muted" id="p1PiecesHint">Aktuell: 0 Stück</div>
        </div>
        <div>
          <label for="p1Qty">Menge</label>
          <input id="p1Qty" type="number" min="0" value="0">
        </div>
        <div>
          <label>Summe</label>
          <input id="p1Subtotal" readonly>
        </div>
      </div>

      <div id="p1NamesBlock" class="grid hidden">
        <label for="p1Names">Namen (ein Name pro Zeile)</label>
        <textarea id="p1Names" rows="5"></textarea>
        <div class="muted">Muss zur Stückzahl passen.</div>
        <div id="p1NamesError" class="error hidden">Anzahl stimmt nicht.</div>
      </div>

      <hr>

      <!-- Produkt 2 -->
      <div class="row">
        <div>
          <label>Produkt 2</label>
          <div class="muted">Stück: 5,00 €</div>
        </div>
        <div>
          <label for="p2Qty">Menge</label>
          <input id="p2Qty" type="number" min="0" value="0">
        </div>
        <div>
          <label>Summe</label>
          <input id="p2Subtotal" readonly>
        </div>
      </div>

      <!-- Produkt 3 -->
      <div class="row">
        <div>
          <label>Produkt 3</label>
          <div class="muted">Stück: 5,00 €</div>
        </div>
        <div>
          <label for="p3Qty">Menge</label>
          <input id="p3Qty" type="number" min="0" value="0">
        </div>
        <div>
          <label>Summe</label>
          <input id="p3Subtotal" readonly>
        </div>
      </div>

      <div class="totals">
        <span>Gesamt</span>
        <span id="grandTotal">0,00 €</span>
      </div>
    </div>


    <!-- Warenkorb -->
    <div class="card">
      <h2>Warenkorb</h2>
      <div id="cartPreview" class="muted">Noch keine Artikel.</div>
    </div>

    <div class="grid" style="grid-template-columns:1fr auto">
      <div class="muted">Abholung in der Schule · Keine Lieferung.</div>
      <button type="submit">Absenden</button>
    </div>

    <div id="formError" class="error hidden"></div>
    <div id="formOk" class="success hidden">Gesendet – wir melden uns!</div>

  </form>


  <footer style="margin-top:2rem;text-align:center;font-size:.95rem;">
    <a href="/impressum.html">Impressum</a> · <a href="/datenschutz.html">Datenschutz</a>
  </footer>

</main>


<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
  /* Dein Key – unverändert */
  const EMAILJS_PUBLIC_KEY   = 'xAOygDJhZcJrXGuSb';
  const EMAILJS_SERVICE_ID   = 'service_l642tri';
  const EMAILJS_TEMPLATE_ID  = 'template_ggtexbv';

  (function() {
    emailjs.init(EMAILJS_PUBLIC_KEY);
  })();
</script>


<script>
/* ======================================================
   FORMAT HILFSFUNKTIONEN
====================================================== */

const formatEUR = n => n.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
const clampInt = (v,min=0,max=999)=>{
  const n=parseInt(v,10);
  if(isNaN(n)) return min;
  return Math.min(max,Math.max(min,n));
};

/* ======================================================
   TICKER
====================================================== */
(function initTicker(){
  const t=document.getElementById('tickerTrack');
  t.innerHTML = `
    <span class="ticker-item">Glas-Tags mit Wunschname – handgefertigt.</span>
    <span class="ticker-item">Deluxe Kakao „Chocolate Bomb“ – solange Vorrat reicht.</span>
    <span class="ticker-item">Instant Kakao „Schneemann“ – saisonale Aktion.</span>
    <span class="ticker-item">Alle Erlöse bleiben im Projekt – Danke!</span>
  `;
})();

/* ======================================================
   STERNE
====================================================== */
(function initStars(){
  const layer=document.getElementById('starsLayer');
  for(let i=0;i<60;i++){
    const s=document.createElement('div');
    s.className='star';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*100+'%';
    layer.appendChild(s);
  }
})();

/* ======================================================
   GEWINNSPIEL
====================================================== */
(function initGame(){

  const startBtn=document.getElementById('startGameBtn');
  const newBtn=document.getElementById('newGameBtn');
  const grid=document.getElementById('gameGrid');
  const msg=document.getElementById('gameMsg');
  const triesLeft=document.getElementById('triesLeft');
  const matchCount=document.getElementById('matchCount');
  const cooldown=document.getElementById('cooldownPill');
  const coolSec=document.getElementById('cooldownSec');

  const COLORS=['#0c8a43','#ffb300','#1565c0'];
  let tiles=[],tries=5,matches=0,running=false,timer=null;

  function build(){
    grid.innerHTML='';
    tiles=[];
    const pool=[];
    COLORS.forEach(c=>{for(let i=0;i<3;i++) pool.push(c);});
    pool.sort(()=>Math.random()-0.5);

    pool.forEach(color=>{
      const t=document.createElement('div');
      t.className='tile';
      t.dataset.color=color;
      const cover=document.createElement('div');
      cover.className='cover';
      t.appendChild(cover);
      t.onclick=()=>reveal(t);
      grid.appendChild(t);
      tiles.push(t);
    });
  }

  function reset(){
    tries=5; matches=0; running=true;
    triesLeft.textContent=tries;
    matchCount.textContent=matches;
    msg.textContent='';
    msg.className='';
    cooldown.classList.add('hidden');
    build();
  }

  function reveal(tile){
    if(!running) return;
    const cover=tile.querySelector('.cover');
    if(!cover || cover.style.opacity==='0') return;
    cover.style.opacity='0';
    tile.style.background=tile.dataset.color;

    const same=tiles.filter(t=>{
      const c=t.dataset.color;
      const oc=t.querySelector('.cover');
      return oc && oc.style.opacity==='0' && c===tile.dataset.color;
    }).length;

    if(same===3){
      matches++;
      matchCount.textContent=matches;
      msg.textContent='Drei gleiche Gläser!';
      msg.className='win';
    }

    tries--;
    triesLeft.textContent=tries;

    if(tries<=0){
      running=false;
      msg.textContent = matches>0
        ? 'Aktion geschafft – Code im Formular eintragen.'
        : 'Leider kein Treffer.';
      msg.className = matches>0 ? 'win' : 'lose';

      let left=30;
      coolSec.textContent=left;
      cooldown.classList.remove('hidden');

      timer=setInterval(()=>{
        left--;
        coolSec.textContent=left;
        if(left<=0){
          clearInterval(timer);
          cooldown.classList.add('hidden');
        }
      },1000);
    }
  }

  startBtn.onclick=()=>{
    startBtn.classList.add('hidden');
    newBtn.classList.remove('hidden');
    reset();
  };

  newBtn.onclick=()=>reset();

})();

/* ======================================================
   SHOP / FORMULAR
====================================================== */

(function initShop(){

  const p1Pack=document.getElementById('p1Pack');
  const p1Qty=document.getElementById('p1Qty');
  const p1Subtotal=document.getElementById('p1Subtotal');
  const p1PiecesHint=document.getElementById('p1PiecesHint');
  const p1NamesBlock=document.getElementById('p1NamesBlock');
  const p1Names=document.getElementById('p1Names');
  const p1NamesError=document.getElementById('p1NamesError');

  const p2Qty=document.getElementById('p2Qty');
  const p2Subtotal=document.getElementById('p2Subtotal');

  const p3Qty=document.getElementById('p3Qty');
  const p3Subtotal=document.getElementById('p3Subtotal');

  const grandTotal=document.getElementById('grandTotal');
  const cartPreview=document.getElementById('cartPreview');

  const PACK_PRICES={single:1.50,pack5:4.95,pack10:9.95};
  const PACK_PIECES={single:1,pack5:5,pack10:10};
  const P2_PRICE=5.00;
  const P3_PRICE=5.00;

  function updateP1(){
    const pack=p1Pack.value;
    const qty=clampInt(p1Qty.value);
    p1Qty.value=qty;

    const totalPrice=qty*PACK_PRICES[pack];
    const totalPieces=qty*PACK_PIECES[pack];

    p1Subtotal.value = qty>0 ? formatEUR(totalPrice) : '';
    p1PiecesHint.textContent="Aktuell: "+totalPieces+" Stück";

    if(totalPieces>0){
      p1NamesBlock.classList.remove('hidden');
    } else {
      p1NamesBlock.classList.add('hidden');
      p1NamesError.classList.add('hidden');
    }

    return {totalPrice,totalPieces,qty,pack};
  }

  function updateP2(){
    const qty=clampInt(p2Qty.value);
    p2Qty.value=qty;
    const tp=qty*P2_PRICE;
    p2Subtotal.value = qty>0 ? formatEUR(tp) : '';
    return {qty,totalPrice:tp};
  }

  function updateP3(){
    const qty=clampInt(p3Qty.value);
    p3Qty.value=qty;
    const tp=qty*P3_PRICE;
    p3Subtotal.value = qty>0 ? formatEUR(tp) : '';
    return {qty,totalPrice:tp};
  }

  function updateAll(){
    const p1=updateP1();
    const p2=updateP2();
    const p3=updateP3();

    const sum=p1.totalPrice+p2.totalPrice+p3.totalPrice;
    grandTotal.textContent=formatEUR(sum);

    const out=[];
    if(p1.totalPieces>0){
      out.push(`Glas-Tag: ${p1.totalPieces} Stück – ${formatEUR(p1.totalPrice)}`);
    }
    if(p2.qty>0){
      out.push(`Chocolate Bomb: ${p2.qty}× – ${formatEUR(p2.totalPrice)}`);
    }
    if(p3.qty>0){
      out.push(`Schneemann: ${p3.qty}× – ${formatEUR(p3.totalPrice)}`);
    }

    cartPreview.innerHTML = out.length? out.join('<br>') : 'Noch keine Artikel.';
  }

  p1Pack.onchange=updateAll;
  p1Qty.oninput=updateAll;
  p2Qty.oninput=updateAll;
  p3Qty.oninput=updateAll;

  if(p1Names) p1Names.oninput=()=>p1NamesError.classList.add('hidden');

  updateAll();

  const form=document.getElementById('orderForm');
  const formErr=document.getElementById('formError');
  const formOk=document.getElementById('formOk');

  function countLines(s){
    return String(s).split(/\n/).map(l=>l.trim()).filter(Boolean).length;
  }

  form.onsubmit=function(e){
    e.preventDefault();
    formErr.classList.add('hidden');
    formOk.classList.add('hidden');

    if(document.getElementById('hp_field').value.trim()!==''){return;}

    const name=document.getElementById('name').value.trim();
    const phone=document.getElementById('phone').value.trim();
    const email=document.getElementById('email').value.trim();
    const coupon=document.getElementById('coupon').value.trim();

    if(!name||!phone||!email){
      formErr.textContent="Bitte Name, Telefon und E-Mail ausfüllen.";
      formErr.classList.remove('hidden');
      return;
    }

    const p1=updateP1();
    const p2=updateP2();
    const p3=updateP3();

    if(p1.totalPieces===0 && p2.qty===0 && p3.qty===0){
      formErr.textContent="Bitte mindestens ein Produkt auswählen.";
      formErr.classList.remove('hidden');
      return;
    }

    if(p1.totalPieces>0){
      const given=countLines(p1Names.value);
      if(given!==p1.totalPieces){
        p1NamesError.classList.remove('hidden');
        formErr.textContent="Die Anzahl der Namen passt nicht.";
        formErr.classList.remove('hidden');
        return;
      }
    }

    const summary=[];
    if(p1.totalPieces>0) summary.push(`Glas-Tag: ${p1.totalPieces} Stück – ${formatEUR(p1.totalPrice)}`);
    if(p2.qty>0) summary.push(`Chocolate Bomb: ${p2.qty}× – ${formatEUR(p2.totalPrice)}`);
    if(p3.qty>0) summary.push(`Schneemann: ${p3.qty}× – ${formatEUR(p3.totalPrice)}`);

    const payload={
      name,
      phone,
      email,
      coupon,
      products: summary.join('<br>'),
      total: formatEUR(p1.totalPrice+p2.totalPrice+p3.totalPrice),
      names_list: p1Names.value
    };

    emailjs.send(EMAILJS_SERVICE_ID,EMAILJS_TEMPLATE_ID,payload)
      .then(()=>{
        formOk.classList.remove('hidden');
        form.reset();
        updateAll();
        p1NamesBlock.classList.add('hidden');
      })
      .catch(()=>{
        formErr.textContent="Formular konnte nicht gesendet werden.";
        formErr.classList.remove('hidden');
      });
  };

})();
</script>

</body>
</html>
